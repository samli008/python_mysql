# deploy kube-apiserver
mkdir -pv /usr/local/kubernetes/{conf,bin,logs}
cp kubectl kube-apiserver kube-scheduler kube-controller-manager /usr/local/kubernetes/bin/

vi /usr/local/kubernetes/conf/kubernetes
KUBE_MASTER="--master=192.168.20.143:8080"
KUBE_LOG_LEVEL="--v=2"
KUBE_LOGTOSTDERR="--logtostderr=false"
KUBE_LOG_DIR="--log-dir=/usr/local/kubernetes/logs/"

vi /usr/local/kubernetes/conf/kube-apiserver
KUBE_API_ADDRESS="--insecure-bind-address=0.0.0.0"
KUBE_API_PORT="--insecure-port=8080"
KUBE_ETCD_SERVERS="--etcd-servers=http://192.168.20.143:2379,http://192.168.20.144:2379,http://192.168.20.151"
KUBE_ALLOW_PRIV="--allow-privileged=true"
KUBE_ADMISSION_CONTROL="--admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ResourceQuota"

vi /usr/lib/systemd/system/kube-apiserver.service
[Unit]
Description=kube-apiserver
After=network.target
[Service]
EnvironmentFile=-/usr/local/kubernetes/conf/kubernetes
EnvironmentFile=-/usr/local/kubernetes/conf/kube-apiserver
ExecStart=/usr/local/kubernetes/bin/kube-apiserver \
            $KUBE_API_ADDRESS \
            $KUBE_API_PORT \
            $KUBE_ETCD_SERVERS \
            $KUBE_LOG_LEVEL \
            $KUBE_LOGTOSTDERR \
            $KUBE_LOG_DIR \
            $KUBE_ALLOW_PRIV \
            $KUBE_ADMISSION_CONTROL
[Install]
WantedBy=multi-user.target

systemctl restart kube-apiserver

kubectl get cs
